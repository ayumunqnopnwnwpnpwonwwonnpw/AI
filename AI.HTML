<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ã‚ªãƒ¼ãƒ«ã‚¤ãƒ³ãƒ¯ãƒ³GPTãƒœãƒƒãƒˆ</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 30px auto; }
#chat { border:1px solid #ccc; height:300px; overflow:auto; padding:10px; }
.user { color:blue; }
.bot { color:green; }
img { max-width:100%; margin-top:10px; }
button { margin:5px 0; }
</style>
</head>
<body>

<h2>ã‚ªãƒªã‚¸ãƒŠãƒ«AIãƒœãƒƒãƒˆ</h2>

<div id="chat"></div>

<input type="text" id="message" style="width:70%;">
<button onclick="sendMessage()">é€ä¿¡</button>
<button onclick="startVoice()">ğŸ¤éŸ³å£°å…¥åŠ›</button>
<button onclick="generateImage()">ğŸ¨ç”»åƒç”Ÿæˆ</button>
<button onclick="clearHistory()">å±¥æ­´å‰Šé™¤</button>

<script>
const API_KEY = "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"; // âš æœ¬ç•ªã§ã¯çµ¶å¯¾NG
const chatDiv = document.getElementById("chat");

// å±¥æ­´èª­ã¿è¾¼ã¿
let history = JSON.parse(localStorage.getItem("chatHistory")) || [];
renderHistory();

function renderHistory(){
  chatDiv.innerHTML = "";
  history.forEach(msg => {
    chatDiv.innerHTML += `<div class="${msg.role}">
      ${msg.role==="user"?"ã‚ãªãŸ":"AI"}: ${msg.content}
    </div>`;
  });
}

function saveHistory(){
  localStorage.setItem("chatHistory", JSON.stringify(history));
}

async function sendMessage(){
  const input = document.getElementById("message");
  const text = input.value;
  if(!text) return;

  history.push({role:"user", content:text});
  renderHistory();
  saveHistory();
  input.value="";

  const response = await fetch("https://api.openai.com/v1/chat/completions",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+API_KEY
    },
    body:JSON.stringify({
      model:"gpt-4o-mini",
      messages:[
        {role:"system",content:"ã‚ãªãŸã¯è¦ªåˆ‡ãªAIã§ã™ã€‚"},
        ...history
      ]
    })
  });

  const data = await response.json();
  const reply = data.choices[0].message.content;

  history.push({role:"assistant",content:reply});
  renderHistory();
  saveHistory();
  speak(reply);
}

// ğŸ¤ éŸ³å£°å…¥åŠ›
function startVoice(){
  const recognition = new(window.SpeechRecognition || window.webkitSpeechRecognition)();
  recognition.lang="ja-JP";
  recognition.start();
  recognition.onresult = function(event){
    document.getElementById("message").value = event.results[0][0].transcript;
  }
}

// ğŸ”Š éŸ³å£°èª­ã¿ä¸Šã’
function speak(text){
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang="ja-JP";
  speechSynthesis.speak(utter);
}

// ğŸ¨ ç”»åƒç”Ÿæˆ
async function generateImage(){
  const prompt = prompt("ç”»åƒã®èª¬æ˜ã‚’å…¥åŠ›");
  if(!prompt) return;

  const response = await fetch("https://api.openai.com/v1/images/generations",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+API_KEY
    },
    body:JSON.stringify({
      model:"gpt-image-1",
      prompt:prompt,
      size:"512x512"
    })
  });

  const data = await response.json();
  const imgUrl = data.data[0].url;
  chatDiv.innerHTML += `<img src="${imgUrl}">`;
}

// å±¥æ­´å‰Šé™¤
function clearHistory(){
  localStorage.removeItem("chatHistory");
  history=[];
  renderHistory();
}
</script>

</body>
</html>
